<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>Inicio</title>
</head>
<body>
<div th:replace="components/base :: page(~{::title}, ~{::section})">
    <title>Inicio</title>

    <section>
        <div class="page-header">
            <h1>Bienvenido a SID Gym ICESI</h1>
            <p class="muted">Accesos rápidos a tus rutinas, plantillas y progreso.</p>
        </div>

        <div class="grid">

            <!-- Mis rutinas (alumnos/colaboradores/admin) -->
            <article class="card" sec:authorize="hasAnyRole('STUDENT','EMPLOYEE','ADMIN')">
                <h2>Mis rutinas</h2>
                <p class="muted">Consulta, edita o crea tus rutinas personales.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/routines}">Ver mis rutinas</a>
                    <a class="btn" th:href="@{/mvc/routines/create}">Crear rutina</a>
                </div>
            </article>

            <!-- Plantillas de entrenadores (cualquier autenticado las puede ver; CRUD lo controla el controlador) -->
            <article class="card" sec:authorize="isAuthenticated()">
                <h2>Plantillas de rutinas</h2>
                <p class="muted">Explora plantillas publicadas por entrenadores y adóptalas.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/routine-templates}">Ver plantillas</a>
                    <a class="btn" sec:authorize="hasAnyRole('TRAINER','ADMIN')" th:href="@{/mvc/routine-templates/create}">Nueva plantilla</a>
                </div>
            </article>

            <!-- Progreso (alumnos/colaboradores/admin)  → el controlador maneja selector si falta routineId -->
            <article class="card" sec:authorize="hasAnyRole('STUDENT','EMPLOYEE','ADMIN')">
                <h2>Mi progreso</h2>
                <p class="muted">Registra tus avances (reps/tiempo/esfuerzo) y revisa tu historial.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/progress/history}">Ver historial</a>
                    <a class="btn" th:href="@{/mvc/progress/history}">Registrar progreso</a>
                </div>
            </article>

            <!-- Card para ADMIN: Ver estadísticas de los entrenadores -->
            <article class="card" sec:authorize="hasRole('ADMIN')">
                <h2>Estadísticas de Entrenadores</h2>
                <p class="muted">Consulta las estadísticas mensuales de todos los entrenadores.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/admin/trainers/stats}">Ver estadísticas</a>
                </div>
            </article>

            <!-- Card para ADMIN: Ver estadísticas de los usuarios -->
            <article class="card" sec:authorize="hasRole('ADMIN')">
                <h2>Estadísticas de Usuarios</h2>
                <p class="muted">Consulta las estadísticas mensuales de todos los usuarios.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/admin/users/stats}">Ver estadísticas</a>
                </div>
            </article>

            <!-- Card para EMPLOYEE con tipo Instructor: Ver estadísticas de su propio rendimiento -->
            <article class="card" sec:authorize="hasRole('EMPLOYEE') and #authentication.principal.employeeType == 'Instructor'">
                <h2>Mis estadísticas como Instructor</h2>
                <p class="muted">Consulta todas las estadísticas mensuales de tu desempeño como Instructor.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/admin/trainers/stats/detail(trainerUsername=${#authentication.principal.username})}">Ver mis estadísticas</a>
                </div>
            </article>

            <!-- Card para EMPLOYEE con tipo diferente (Entrenador/Estudiante) o para STUDENT: Ver estadísticas de sí mismo -->
            <article class="card" sec:authorize="hasRole('EMPLOYEE') and (#authentication.principal.employeeType == null or #authentication.principal.employeeType != 'Instructor') or hasRole('STUDENT')">
                <h2>Mis estadísticas</h2>
                <p class="muted">Consulta todas las estadísticas mensuales de tu desempeño.</p>
                <div class="actions">
                    <a class="btn" th:href="@{/mvc/admin/users/stats/detail(userUsername=${#authentication.principal.username})}">Ver mis estadísticas</a>
                </div>
            </article>

        </div>
    </section>
</div>
</body>
</html>