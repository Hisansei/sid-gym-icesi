<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{components/base :: page(
          title='Historial de progreso',
          content=~{::content}
      )}">
<section th:fragment="content">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <header class="site-header">
        <div class="container actions">
            <h1 class="page-title">Historial: <span th:text="${routine.name}">Rutina</span></h1>
            <nav class="actions">
                <a class="btn" th:href="@{/mvc/progress/history}">Cambiar rutina</a>
                <a class="btn" th:href="@{'/mvc/progress/' + ${routine.id}}">Registrar progreso</a>
            </nav>
        </div>
    </header>

    <main class="container card">
        <table class="table">
            <thead>
            <tr><th>Fecha</th><th>Entradas</th><th>Detalle</th></tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(logs)}">
                <td class="muted" colspan="3">Aún no hay registros para esta rutina.</td>
            </tr>

            <tr th:each="l : ${logs}">
                <td>
                    <div th:text="${#temporals.format(l.date, 'yyyy-MM-dd')}">2025-11-08</div>
                    <div class="muted" th:if="${l.createdAt != null}"
                         th:text="${'Creado: ' + #temporals.format(l.createdAt, 'yyyy-MM-dd HH:mm')}">
                        Creado
                    </div>
                </td>
                <td th:text="${#lists.size(l.entries)} + ' ejercicios'">0 ejercicios</td>
                <td>
                    <ul style="margin:0;padding-left:18px">
                        <li th:each="e : ${l.entries}"
                            th:text="${(e.completed ? '✔ ' : '• ')
                                      + (exerciseMap[e.exerciseId] != null ? exerciseMap[e.exerciseId].name : e.exerciseId)
                                      + (e.effortLevel != null ? (' — RPE ' + e.effortLevel) : '')
                                      + (e.notesUser != null && !#strings.isEmpty(e.notesUser) ? (' — ' + e.notesUser) : '')}">
                            entrada
                        </li>
                    </ul>
                </td>
            </tr>
            </tbody>
        </table>
    </main>
</section>
</html>
