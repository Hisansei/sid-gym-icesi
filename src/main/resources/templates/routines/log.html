<section th:fragment="content">
    <div class="container" th:with="r=${routine}">
        <h2>Registrar progreso — <span th:text="${r.name}">Rutina</span></h2>
        <form th:action="@{/mvc/progress/log}" method="post" class="form" style="gap:12px">
            <input type="hidden" name="routineId" th:value="${r.id}">
            <label>Fecha</label>
            <input type="date" name="date" th:value="${today}">

            <div th:if="${#lists.isEmpty(r.items)}" class="alert-info">
                Esta rutina no tiene ejercicios. <a th:href="@{|/mvc/routines/detail?id=${r.id}|}">Agrega algunos primero.</a>
            </div>

            <div th:each="it : ${r.items}" class="card" style="padding:12px;margin-bottom:12px">
                <h4>
                    <span th:text="${it.orderIndex}">1</span>.
                    <span th:if="${it.exerciseId != null}"
                          th:text="${#lists.findFirst(routine.items, x->x.id==it.id) != null ?
                         (#lists.findFirst(#vars.catalog, ex -> ex.id == it.exerciseId)?.name) : 'Ejercicio'}"></span>
                    <span th:if="${it.exerciseId == null}" th:text="${it.customName}">Personalizado</span>
                </h4>
                <div style="display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px">
                    <div>
                        <label>Reps</label>
                        <input type="number" min="0" th:name="${'reps_' + it.id}">
                    </div>
                    <div>
                        <label>Tiempo (seg)</label>
                        <input type="number" min="0" th:name="${'time_' + it.id}">
                    </div>
                    <div>
                        <label>Esfuerzo (RPE)</label>
                        <input type="number" min="1" max="10" th:name="${'rpe_' + it.id}">
                    </div>
                    <div style="grid-column:1/-1">
                        <label>Notas</label>
                        <input type="text" th:name="${'notes_' + it.id}" placeholder="Cómo te sentiste, ajustes, etc.">
                    </div>
                </div>
            </div>

            <div style="margin-top:12px">
                <button class="btn">Guardar progreso</button>
                <a class="btn ghost" th:href="@{|/mvc/routines/detail?id=${r.id}|}">Volver</a>
            </div>
        </form>
    </div>
</section>
