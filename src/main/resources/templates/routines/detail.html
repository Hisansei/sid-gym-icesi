<section th:fragment="content">
    <div class="container">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <h2 th:text="${routine != null ? routine.name : 'Rutina'}">Rutina</h2>
            <div>
                <form th:action="@{|/mvc/routines/${routine.id}/rename|}" method="post" style="display:inline">
                    <input type="text" name="name" th:value="${routine.name}" required>
                    <button class="btn ghost">Renombrar</button>
                </form>
                <a class="btn" th:href="@{|/mvc/progress/log?routineId=${routine.id}|}">Registrar progreso</a>
                <a class="btn ghost" th:href="@{|/mvc/progress/history?routineId=${routine.id}|}">Ver histórico</a>
            </div>
        </div>

        <table class="table" th:if="${routine != null}">
            <thead>
            <tr><th>#</th><th>Nombre</th><th>Tipo</th><th>Objetivo</th><th></th></tr>
            </thead>
            <tbody>
            <tr th:each="it : ${routine.exercises}">
                <td th:text="${it.order}">1</td>
                <td>
                    <span th:if="${it.name != null}" th:text="${it.name}">Ejercicio</span>
                    <span th:if="${it.name == null and it.exerciseId != null}"
                            th:text="${#lists.findFirst(catalog, ex -> ex.id == it.exerciseId)?.name}">Ejercicio</span>
                    <span th:if="${it.name == null and it.exerciseId == null}">Personalizado</span>
                </td>
                <td th:text="${it.type}">fuerza</td>
                <td>
                    <span th:if="${it.reps != null}" th:text="${it.reps + ' reps'}"></span>
                    <span th:if="${it.sets != null}" th:text="${(it.reps != null ? ' / ' : '') + it.sets + ' sets'}"></span>
                    <span th:if="${it.durationSeconds != null}"
                            th:text="${((it.reps != null or it.sets != null) ? ' / ' : '') + T(java.lang.Math).round(it.durationSeconds/60.0) + ' min'}"></span>
                </td>
                <td style="text-align:right">
                    <form th:action="@{|/mvc/routines/${routine.id}/items/${it.id}/remove|}" method="post" style="display:inline">
                        <button class="btn ghost" onclick="return confirm('¿Eliminar ítem?')">Eliminar</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(routine.exercises)}">
                <td colspan="5" style="text-align:center;color:var(--muted)">Aún no hay ejercicios en esta rutina.</td>
            </tr>
            </tbody>
        </table>

        <div style="margin-top:24px">
            <h3>Agregar ejercicio</h3>
            <form th:action="@{|/mvc/routines/${routine.id}/items/add|}" method="post" class="form" style="gap:12px">
                <fieldset>
                    <legend>Desde el catálogo</legend>
                    <select name="exerciseId">
                        <option value="">-- Elegir --</option>
                        <option th:each="ex : ${catalog}" th:value="${ex.id}"
                                th:text="${ex.name + ' (' + ex.type + ')'}">Sentadilla</option>
                    </select>
                </fieldset>

                <p style="margin:8px 0; color:var(--muted)">o define uno personalizado:</p>

                <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px">
                    <div>
                        <label>Nombre personalizado</label>
                        <input type="text" name="name" placeholder="Ej. Remo con banda">
                    </div>
                    <div>
                        <label>Tipo</label>
                        <select name="type">
                            <option value="">-- Tipo --</option>
                            <option value="fuerza">fuerza</option>
                            <option value="cardio">cardio</option>
                            <option value="movilidad">movilidad</option>
                        </select>
                    </div>
                    <div>
                        <label>Reps</label>
                        <input type="number" name="reps" min="1" step="1">
                    </div>
                    <div>
                        <label>Sets</label>
                        <input type="number" name="sets" min="1" step="1">
                    </div>
                    <div>
                        <label>Duración (seg.)</label>
                        <input type="number" name="durationSeconds" min="0" step="1">
                    </div>
                </div>

                <div style="margin-top:12px">
                    <button class="btn">Agregar</button>
                </div>
            </form>
        </div>
    </div>
</section>
